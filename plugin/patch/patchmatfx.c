/*===========================================================================*
 *-                                                                         -*
 *-  Module  :   patchmatfx.c                                               -*
 *-                                                                         -*
 *-  Purpose :   Matfx patch handling.                                      -*
 *-                                                                         -*
 *===========================================================================*/

/*===========================================================================*
 *--- Include files ---------------------------------------------------------*
 *===========================================================================*/
#include <rwcore.h>
#include <rpworld.h>

#include "rpplugin.h"
#include "rpdbgerr.h"

#include "rppatch.h"

#include "patchgeometry.h"
#include "patchmesh.h"
#include "patchmatfx.h"
#include "patch.h"

/*===========================================================================*
 *--- Private Types ---------------------------------------------------------*
 *===========================================================================*/

/*===========================================================================*
 *--- Private Global Variables ----------------------------------------------*
 *===========================================================================*/

/*===========================================================================*
 *--- Private Defines -------------------------------------------------------*
 *===========================================================================*/

/*===========================================================================*
 *--- Local Types -----------------------------------------------------------*
 *===========================================================================*/

/*===========================================================================*
 *--- Local Global Variables ------------------------------------------------*
 *===========================================================================*/
/*===========================================================================*
 *--- Local Defines ---------------------------------------------------------*
 *===========================================================================*/

/*===========================================================================*
 *--- Local functions -------------------------------------------------------*
 *===========================================================================*/

/*===========================================================================*
 *--- Private functions -----------------------------------------------------*
 *===========================================================================*/

/****************************************************************************
 _rpPatchMeshSearchForEffect

 Works through the patch meshes materials searching for the first material
 effect.

 Inputs : patchMesh - RpPatchMesh we should search.

 Outputs: RpMatFXMaterialFlags - First effect found, or rpMATFXEFFECTNULL
                                 if none.
 */
RpMatFXMaterialFlags
_rpPatchMeshSearchForEffect(RpPatchMesh *patchMesh)
{
    RwUInt32 iMaterial;

    RWFUNCTION(RWSTRING("_rpPatchMeshSearchForEffect"));
    RWASSERT(NULL != patchMesh);

    /* Search the materials for effects. */
    for( iMaterial = 0; iMaterial < RpPatchMeshGetNumMaterials(patchMesh);
         iMaterial++ )
    {
        RpMatFXMaterialFlags effect;
        RpMaterial *material;

        material = RpPatchMeshGetMaterial(patchMesh, iMaterial);
        RWASSERT(NULL != material);

        effect = RpMatFXMaterialGetEffects(material);

        if(effect != rpMATFXEFFECTNULL)
        {
            RWRETURN(effect);
        }
    }

    RWRETURN(rpMATFXEFFECTNULL);
}

/*===========================================================================*
 *--- Plugin Engine Functions -----------------------------------------------*
 *===========================================================================*/

/*===========================================================================*
 *--- Plugin API Functions --------------------------------------------------*
 *===========================================================================*/
